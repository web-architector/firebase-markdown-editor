(this["webpackJsonpmardown-editor"]=this["webpackJsonpmardown-editor"]||[]).push([[0],{151:function(e,t,n){e.exports=n(460)},156:function(e,t,n){},167:function(e,t,n){},169:function(e,t,n){},458:function(e,t,n){},460:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(12),c=n.n(o),i=(n(156),n(23)),u=n(146),s=(n(162),n(34)),l=(n(164),n(461),s.apps.length?s.app():s.initializeApp({apiKey:"AIzaSyCSZh_3E5FOk1i43svfJLLeyQSn9HImwkw",authDomain:"markdown-editor-2efef.firebaseapp.com",databaseURL:"https://markdown-editor-2efef.firebaseio.com",projectId:"markdown-editor-2efef",storageBucket:"markdown-editor-2efef.appspot.com",messagingSenderId:"252242878217",appId:"1:252242878217:web:89cd2d47ea52ebb7bdbdd8"})),d=l.auth(),f=l.firestore(),m=l.storage(),b={googleProvider:new s.auth.GoogleAuthProvider,githubProvider:new s.auth.GithubAuthProvider},p=(n(167),Object(u.a)({providers:b,firebaseAppAuth:d})((function(e){var t=e.signInWithGoogle,n=e.signInWithGithub,a=e.signOut,o=e.user,c=e.loading;return r.a.createElement(r.a.Fragment,null,c&&r.a.createElement(L,null),r.a.createElement("header",{className:"header"},r.a.createElement("h2",null,"\u0423\u043c\u043d\u044b\u0439 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440"),o&&r.a.createElement("div",{className:"user-profile"},r.a.createElement("a",{className:"log-out-link",href:"#log-out",onClick:function(){console.log("Signed out..."),a()}},"\u0412\u044b\u0439\u0442\u0438"),r.a.createElement("img",{alt:"Profile",className:"avatar",src:o.photoURL}))),r.a.createElement(i.b,{basepath:"/firebase-markdown-editor"},r.a.createElement(G,{path:"/",user:o,signIns:{signInWithGithub:n,signInWithGoogle:t}}),r.a.createElement(I,{path:"user/:userId",user:o}),r.a.createElement(C,{path:"user/:userId/editor/:fileId",user:o})))}))),h=n(52),g=n(14),v=n.n(g),E=n(29),w=n(30),k=(n(169),function(){var e=Object(E.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.collection("users").doc(t).get();case 2:if(!(n=e.sent).exists){e.next=11;break}return console.log("User found in database"),e.next=7,f.collection("users").doc(n.id).collection("files").get();case 7:return a=e.sent,r=[],a.forEach((function(e){var t=e.data(),n=t.name,a=t.content;r.push({id:e.id,name:n,content:a})})),e.abrupt("return",r);case 11:return console.log("User not found in database, creating new entry..."),e.next=14,f.collection("users").doc(t).set({});case 14:return e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),j=function(){var e=Object(E.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.collection("users").doc(t).collection("files").add({name:n,content:""});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=Object(E.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.collection("users").doc(t).collection("files").doc(n).delete();case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I=function(e){var t=e.user,n=e.userId,o=Object(a.useState)(""),c=Object(h.a)(o,2),u=c[0],s=c[1],l=Object(w.a)(n,k),d=l.data,f=l.error;return Object(a.useEffect)((function(){if(!t){Object(i.c)("/firebase-markdown-editor").then()}}),[t]),f?(console.error(f),r.a.createElement("p",null,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445!")):d?r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),u&&(s(""),j(n,u).then(),Object(w.b)(n).then())},className:"new-file-form"},r.a.createElement("input",{type:"text",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430...",value:u,onChange:function(e){return s(e.target.value)}}),r.a.createElement("button",{type:"submit",className:"add-button"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")),r.a.createElement("ul",{className:"files-list"},d.map((function(e){return r.a.createElement("li",{key:e.id,className:"file"},r.a.createElement(i.a,{to:"".concat("/firebase-markdown-editor","/user/").concat(n,"/editor/").concat(e.id),className:"link"},e.name),r.a.createElement("button",{type:"button",onClick:function(){O(n,e.id).then((function(){return Object(w.b)(n)}))},className:"delete-button"},"x"))})))):r.a.createElement("p",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...")},x=n(147),y=n.n(x),N=n(35),S=(n(458),n(459),function(){var e=Object(E.a)(v.a.mark((function e(t,n){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.collection("users").doc(t).collection("files").doc(n).get();case 2:return a=e.sent,e.abrupt("return",a.data());case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),C=function(e){var t=e.user,n=e.userId,o=e.fileId;Object(a.useEffect)((function(){if(!t){console.log('###: Editor: User has log out. Redirecting to "'.concat("/firebase-markdown-editor",'"')),Object(i.c)("/firebase-markdown-editor").then()}}),[t]);var c=Object(w.a)([n,o],S),u=c.data,s=c.error,l=Object(a.useState)(null),d=Object(h.a)(l,2),b=d[0],p=d[1];Object(a.useEffect)((function(){void 0!==u&&null===b&&(console.log("Set initial content in state. length=",u.content.length),p(u.content))}),[u,b]);var g=function(e){return N.b.warning("You have unsaved changes!"),e.preventDefault(),e.returnValue="You have unsaved changes!","You have unsaved changes!"};Object(a.useEffect)((function(){return u&&u.content!==b?window.addEventListener("beforeunload",g):window.removeEventListener("beforeunload",g),function(){return window.removeEventListener("beforeunload",g)}}));var k=function(){var e=Object(E.a)(v.a.mark((function e(t){var a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.size<=1e5)){e.next=8;break}return e.next=3,f.collection("users").doc(n).collection("images").add({name:t.name});case 3:return a=e.sent,e.next=6,m.ref().child("users/".concat(n,"/").concat(a.id,"-").concat(t.name)).put(t);case 6:return r=e.sent,e.abrupt("return",r.ref.getDownloadURL());case 8:N.b.error(" Image should be less then 100kb!");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return s?(console.error(s),r.a.createElement("p",null,"We had an issue while getting the data")):u?r.a.createElement("div",null,r.a.createElement("header",{className:"editor-header"},r.a.createElement(i.a,{className:"back-button",to:"".concat("/firebase-markdown-editor","/user/").concat(n)},"<"),r.a.createElement("h3",null,u.name),r.a.createElement("button",{disabled:u.content===b,onClick:function(){f.collection("users").doc(n).collection("files").doc(o).update({content:b}),Object(w.b)([n,o]).then(),N.b.success("Your changes have been saved!")},className:"save-button",type:"button"},"Save Changes")),r.a.createElement("div",{className:"editor"},r.a.createElement(y.a,{defaultValue:u.content,onChange:function(e){p(e())},uploadImage:k,onShowToast:function(e){return Object(N.b)(e)}})),r.a.createElement(N.a,null)):r.a.createElement("p",null,"Loading...")},G=function(e){var t=e.user,n=e.signIns,o=n.signInWithGoogle,c=n.signInWithGithub;return Object(a.useEffect)((function(){if(t){var e="".concat("/firebase-markdown-editor","/user/").concat(t.uid);console.log('###: SignIn component: User found. Redirecting to "'.concat(e,'"')),Object(i.c)(e).then()}}),[t]),r.a.createElement("div",{className:"sign-in-page"},r.a.createElement("h3",null,"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432",r.a.createElement("em",null," \u0423\u043c\u043d\u044b\u0439 \u0420\u0435\u0434\u0430\u043a\u0442\u043e\u0440"),"!"),r.a.createElement("p",null,"\u0414\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0412\u0430\u0448\u0438\u0445 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0438 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430\u043c\u0438 \u0432\u043e\u0439\u0434\u0438\u0442\u0435, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043e\u0434\u043d\u0443 \u0438\u0437 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0439 \u0441\u0435\u0442\u0438"),r.a.createElement("div",{className:"sign-in-buttons"},r.a.createElement("button",{type:"button",onClick:o},"\u0412\u0445\u043e\u0434 \u0447\u0435\u0440\u0435\u0437 Google"),r.a.createElement("button",{type:"button",onClick:c},"\u0412\u0445\u043e\u0434 \u0447\u0435\u0440\u0435\u0437 GitHub")))},L=function(){return r.a.createElement("div",{style:{position:"fixed",display:"flex",top:0,alignItems:"center",justifyContent:"center",width:"100%",height:"2.68em",background:"green",color:"white"}},"Loading..")};c.a.render(r.a.createElement(r.a.Fragment,null,r.a.createElement(p,null)),document.getElementById("root"))}},[[151,1,2]]]);
//# sourceMappingURL=main.4bdbb394.chunk.js.map